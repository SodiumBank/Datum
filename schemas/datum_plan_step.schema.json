{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://datum.example/schemas/datum_plan_step.schema.json",
  "title": "DatumPlanStep",
  "type": "object",
  "additionalProperties": false,
  "required": ["step_id", "type", "title", "sequence", "required", "locked_sequence", "source_rules"],
  "properties": {
    "step_id": { "$ref": "./datum_common.schema.json#/$defs/id" },
    "type": {
      "type": "string",
      "enum": [
        "FAB", "ASSEMBLY",
        "CLEAN", "BAKE",
        "POLYMER", "CURE",
        "INSPECT", "TEST",
        "PROGRAM", "LEAD_FORM",
        "SELECTIVE_SOLDER",
        "PACK"
      ]
    },
    "title": { "type": "string", "minLength": 1, "maxLength": 128 },
    "sequence": { "type": "integer", "minimum": 1, "maximum": 9999 },
    "required": { "type": "boolean" },
    "locked_sequence": { "type": "boolean" },
    "parameters": {
      "type": "object",
      "additionalProperties": true
    },
    "acceptance": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "criteria": { "type": "string", "maxLength": 2048 },
        "sampling": { "type": "string", "enum": ["100_PERCENT", "LOT_SAMPLE", "AQL"], "default": "100_PERCENT" }
      }
    },
    "source_rules": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "./datum_rule_ref.schema.json" }
    }
  }
}
